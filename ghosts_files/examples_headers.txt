'''
<file_name.py>

Breve Descrição

Referencias

Editor: Antonio Campos
Github profile: @avgcampos
Last update: 5/10/2023

--------------------------------------------------------
Desenho ilustrativo simplificado em ASCII

'''

#------------------------- IMPORTS FROM MYFEMPY ------------------------------#
from myfempy.mesh.genmesh import ModelGen
from myfempy.core.solver import Solver
from myfempy.postprc.postcomp import PostProcess
from myfempy.plots.postplot import postproc_plot
from myfempy.plots.prevplot import preview_plot

#----------------------------- PRE-PROCESS -----------------------------------#
mat = {
    "NAME": "material",
    "VXX": 0.35,
    "EXX": 5.0E9,
    "MAT": 'isotropic',
    "DEF": 'planestress'
}

geo = {"NAME": "geo1", "THICKN": 1.0}

force = {'DEF': 'forceedge',
         'DOF': 'fx',
         'DIR': 'edgex',
         'LOC': {'x': 0, 'y': 999, 'z': 0},
         'VAL': [1.0],
         }

bondcond = {'DEF': 'fixed',
            'DOF': 'all',
            'DIR': 'edgey',
            'LOC': {'x': 999, 'y': 0, 'z': 0},
            }

#-------------------------- GEN WITH LEGACY MESH ----------------------------#
# Mesh generation by internal command 
meshdata = {"LEGACY": {'lx': 0.5, 'ly': 10, 'mesh': 'quad4', 'elem': 'plane41', 'nx': 10, 'ny': 100},
            "PROPMAT": [mat],
            "PROPGEO": [geo],
            "FORCES": [force],
            "BOUNDCOND": [bondcond],
            "QUADRATURE": {'meth': 'gaussian', 'npp': 4},
            "DOMAIN":'structural'
            }

#------------------------------ GEN WITH GMSH -------------------------------#
# Alternative: Mesh generation by gmsh 
# points = [[0, 0, 0],
#           [4000, 0, 0],
#           [4000, 1000, 0],
#           [0, 1000, 0]]

# lines = [[1, 2],
#          [2, 3],
#          [3, 4],
#          [4, 1]]

# plane = [[1, 2, 3, 4]]

# meshdata = {"GMSH": {'filename': 'malha',
#                      'pointlist': points,
#                      'linelist': lines,
#                      'planelist': plane,
#                      'meshconfig': {
#                          'mesh': 'quad4',
#                          'elem': 'plane41',
#                          'sizeelement': 100,
#                          'meshmap': {'on': True,
#                                      'edge': 'all'}}},
#             "PROPMAT": [mat],
#             "PROPGEO": [geo],
#             "FORCES": [force],
#             "BOUNDCOND": [bondcond],
#             "QUADRATURE": {'meth': 'gaussian', 'npp': 4}
#             }

#-------------------------------- GEN MODEL -----------------------------------#
modelinfo = ModelGen.get_model(meshdata)

#------------------------------ PREVIEW MODEL ---------------------------------#
previewset = {'RENDER': {'filename': 'malha_triagular_pre', 'show': True, 'scale': 4, 'savepng': False, 'lines': False, 'plottags': {'point': False}},
              'QUALITY': {'show': False, 'method': 1, 'scale': 0.1},
              'LABELS': {'show': False, 'lines': True, 'scale': 1},
              }

preview_plot(previewset, modelinfo)

#-------------------------------- SOLVER -------------------------------------#
solverset = {"SOLVER": 'SLI',
             'TOL': 1E-8,
             "STEPSET": {'type': 'table',  # mode, freq, time ...
                         'start': 0,
                         'end': 1,
                         'step': 1},
             #"TRACKER": {'show': False, 'result2plot': 'displ', 'max': []}
             }

solution = Solver.get_static_solve(solverset, modelinfo)

#----------------------------- POST-PROCESS ----------------------------------#
postprocset = {"SOLUTION": solution,
            "COMPUTER": {'elasticity': {'displ': True, 'stress': True, 'average': True}},
            "PLOTSET": {'show': True, 'data': {'displ': []}, 'filename': 'su2_test', 'savepng': False}}

postporc_result = PostProcess(modelinfo).compute(postprocset)

#----------------------------- VIEW SOLUTION ---------------------------------#
postproc_plot(postprocset, postporc_result, modelinfo)
